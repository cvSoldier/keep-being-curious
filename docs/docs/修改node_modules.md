---
title: 修改node_modules
date: 2022-02-14
---

### 起因
起因是使用ant-design-vue组件的tree时，我的需求是父节点收起后能继续选中子节点，但是组件库的代码逻辑里，是否渲染子节点完全基于是否展开  
```javascript
// ant-design-vue/components/vc-tree/src/TreeNode.jsx
// version: "1.7.8"
renderChildren() {
  // ...
  if (expanded) {
    $children = (
      <ul
        class={classNames(
          `${prefixCls}-child-tree`,
          expanded && `${prefixCls}-child-tree-open`,
        )}
        data-expanded={expanded}
        role="group"
      >
        {mapChildren(nodeList, (node, index) => renderTreeNode(node, index, pos))}
      </ul>
    );
  }
  return <transition {...animProps}>{$children}</transition>;
}
```
简单的改动方式就是用v-show来渲染children：
```javascript
// 打包之后的node_modules代码
var $children = void 0;
// if (expanded) {
$children = h(
  'ul',
  {
    'class': classNames(prefixCls + '-child-tree', expanded && prefixCls + '-child-tree-open'),
    attrs: { 'data-expanded': expanded,
      role: 'group',
    },
    directives: [
      {
        name: 'show',
        value: expanded,
      },
    ],
  },
  [mapChildren(nodeList, function (node, index) {
    return renderTreeNode(node, index, pos);
  })]
);
// }
```
修改之后生效了，但是怎么把本地node_modules的改动同步到远端。  
### 解决方法
1.去提issue或者pr。  
2.官方不给改的话，可以使用patch-package，下面说如何操作  

#### 第一步 安装依赖
```
npm i patch-package postinstall-postinstall --save-dev
```
#### 第二步 修改package.json
```JSON
"scripts": {
  "postinstall": "npx patch-package"
}
```
#### 第三步 修改 node_modules 文件，并生成修改文件
修改之后执行
```
npx patch-package ${修改的包名}
```
运行之后会在node_modules同级生成patches文件夹  
├── node_modules  
├── patches                     
│    └── 包名.patch

#### 第四步 测试
重装依赖，对 node_modules 下代码的修改还是被 patch-package 还原并最终生效。